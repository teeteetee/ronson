doctype html(lang='en')
head
    meta(charset='utf-8')
    |     
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    |     
    meta(name='viewport', content='width=device-width, initial-scale=1')
    |     
    title Recent ones
    // Bootstrap
    link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')
    link(href='/transitions/animations.css', rel='stylesheet')
    // HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
      script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')
      |       
      script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')     
    style.
      @font-face {
      font-family:roboto-thin;
      src:url('/bootstrap/fonts/Roboto-Thin.ttf');
      }
      @font-face {
      font-family:high;
      src: url('/bootstrap/fonts/Attentica.ttf');
      }
      @font-face {
      font-family:br;
      src: url('/bootstrap/fonts/bebasneue_regular.ttf');
      }
      @font-face {
      font-family:bt;
      src: url('/bootstrap/fonts/bebasneue_thin.ttf');
      }
      body {
      min-width:768px;
      background-color:#ddd;
      }
      h5{
      letter-spacing:2px;
      text-transform:uppercase;
      margin-bottom:0px;
      color:white;
      font-family:roboto-thin;
      font-size:30px;
      margin-top:0px;
      }
      h2 {
      letter-spacing:2px;
      text-transform:uppercase;
      font-family:high;
      margin-bottom:0px;
      }
      h6{
      font-family:roboto-thin; 
      text-transform:uppercase;
      margin-top:0px;
      color:lightgray;
      margin-bottom:0px;
      letter-spacing:2px;
      }
      #welcome {
      position:absolute;
      z-index:3000;
      width:100%;
      height:100%;
      -ms-background-color:lightblue;
      }
      .main{
      #{filters}
      }
      .col-lg-4 {
      margin-bottom: 20px;
      text-align: center;
      }
      .list-group-item:last-child {
      border-bottom: 2px solid #c2c2c2;
      }
      .pt-perspective {
      position: relative;
      width: 100%;
      height: 100%;
      perspective: 1200px;
      transform-style: preserve-3d;
      }
      .pt-page {
      width: 100%;
      height: 100%;
      position: absolute;
      z-index:100;
      top: 0;
      left: 0;
      visibility: hidden;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      transform: translate3d(0, 0, 0);
      }
      .pt-page-current,
      .no-js .pt-page {
      visibility: visible;
      z-index:200;
      }
      .no-js body {
      overflow: auto;
      }
      .pt-page-ontop {
      z-index: 300;
      }
      .away {
        display: inline-block;
        padding: 5px 14px;
        background-color: #4F4F4F; 
        border-radius:15px;
        margin-bottom:10px;
        color:#999999;
      }
      .away:hover {
      text-decoration: none;
      color:#09BCFD;
      }
      .back {
        background-color:#4F4F4F !important;
      }
      #close {
      padding: 10px 16px;
      font-size: 18px;
      line-height: 1.3333333;
      border-radius:30px;
      background-color:rgba(225,225,225,0.25);
      border-color:white;
      color:white;
      }
      .previous:hover{
        border:1 px solid #09bcf5
        color:#09bcf5;
      }
      #wrap a:hover{
        text-decoration:none;
        color:#09BCFD !important;
      }
      #pano canvas {
        border-top-left-radius:8px;
        border-top-right-radius:8px;
        z-index:600;
      }
      :-webkit-full-screen-ancestor:not(iframe) {
       z-index: 5000 !important;
      }
      .list-group {
        cursor:pointer;
      }
  body
    script.
      if(screen.width < 414){
      window.location='http://m.recentones.com/';
      }
    
    nav(class="navbar navbar-inverse navbar-fixed-top",style='z-index:500;')
      .container
        .navbar-header
          a(class="navbar-brand" style='padding:5px;' href="/")
            img(alt="Logo",id='logo',src="/bootstrap/images/rl.png",height='40',width='40')
        .collapse.navbar-collapse#navbar-collapse-9
          ul(class='nav navbar-nav')
            li
              a(href='/',style='font-family:high;font-size:20px;letter-spacing:2px;') Лента 
            li
              a(href='/top',style='font-family:high;font-size:20px;letter-spacing:2px;') Рейтинги 
            li
              a(href='/misc/1',style='font-family:high;font-size:20px;letter-spacing:2px;') Инфо 
          form(class="navbar-form navbar-right" action='/srch' method='post' id='srch' role="search")
           .input-group
              input(type="text" class="form-control" name='searchfield' id='searchfield' style='background-color:#333;color:white;border-color:#333;border-top-left-radius:20px;border-bottom-left-radius:20px;') 
              span(class='input-group-btn')
                button(class="btn btn-default" type="submit" id='searchbutton' style='padding-top:9px;padding-bottom:9px;background-color:#333;color:gray;border-color:#333;border-top-right-radius:20px;border-bottom-right-radius:20px;')
                  span(class='glyphicon glyphicon-search') 
    .pt-perspective(id='pt-main')
      .pt-page.pt-page-1(style='visibility:visible;')
        .wrap(style='overflow:auto;height:100vh;')
          .main.container(style='margin-top:50px;z-index:2;',id='main')  
            .row
              #inserts.col-xs-12
                each place, i in doc
                  .row(style='margin-top:15px;margin-bottom:15px;')
                    .col-xs-6.col-xs-offset-3
                      ul(class='list-group')
                        li(style='padding:0px;' class='list-group-item')
                          a(onclick='openpanel(#{place.pid}')
                            img(style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='#{place.mainpreview}')
                        li(class='list-group-item')
                          h2(style='margin-top:0px;') #{place.placenameru}
                          h6(style='color:gray;') #{place.founddate.day}.#{place.founddate.month}.#{place.founddate.year}

      .pt-page.pt-page-2(id='panel' style='background-color:#333;height:100vh;overflow:auto;')
      script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js')
      script(src='/transitions/modernizr.custom.js')
      script(src='/transitions/pagetransitions.js')
      script(async src='/js/bootstrap.min.js')
      script( async, type='text/javascript', src='/js/pano2vr_player.js')
      script.
        // LOGO COLOURING
       
        function openpanel(pid) {
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        if(parsed.trouble === 1)
        {
        console.log('TROUBLE === 1');
        switch (parsed.mtext){
        case('db'):
        alert('Sorry, our database is being updated');
        break;
        case('empty'):
        alert('EMPTY');
        break;
        }}
        else {
        console.log('choice');
        //trouble === 0
        var place = parsed.place;
        if(!parsed.place.pano){
          console.log('empty');
          var placename = place.placenameru;
          var www = place.contacts.www;
          var adressru = place.adressru;
          var adressen = place.adressen;
          var phone = place.contacts.phone;
          var insert = "<div style='margin-top:60px;' class='container'><div class='row'><div class='col-xs-12'><nav><ul class='pager'><li class='previous'><a onclick='back("+pid+")' style='color:#999999;border:0px;' class='back'>Назад</a></li><li style='text-align:center;'><h3 style='color:#999999;display:inline;font-family:roboto-thin;'>"+placename+"</h3></li><li class='next' style='visibility:hidden;'><a>Назад</a></li></ul></nav></div></div><div class='row'><div class='col-xs-12'><ul class='list-group'><li style='padding:100px;text-align:center;background-color:inherit;border: 1px solid #4f4f4f;border-top-left-radius: 8px;border-top-right-radius: 8px;' class='list-group-item'><img src='/bootstrap/images/bl.png' style='width:10vw;margin-bottom:20px;'/><h5>Мы тур еще не отсняли &#40&#45&#58</h5></li><li style='padding-bottom:15px;border:1px solid #4f4f4f;border-bottom:1px solid #4f4f4f;background-color:inherit;border-bottom-right-radius:8px;border-bottom-left-radius:8px;' class='list-group-item'><a class='away' href='"+www+"'>На сайт</a><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+adressru+"</h5><h5 style='color:#747474;font-size:15px;font-weight:bold;margin-bottom:5px;'>"+adressen+"</h5><a href='tel:"+phone+"'><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+phone+"</h5></a></li></ul></div></div></div>";
          $('#panel').append(insert);
          $('.pt-page-2').removeClass('pt-page-moveToRight');
          $('.pt-page-2').css('display','block').addClass('pt-page-moveFromRight pt-page-delay200 pt-page-ontop pt-page-current').css('overflow','auto');
          setTimeout(function(){$('.pt-page-1').removeClass('pt-page-current').css({'overflow':'hidden','visibility':'hidden'});},1000);
          console.log('did output');
        }
        else {
          console.log('haspano');
          var placename = place.placenameru;
          var adressru = place.adressru;
          var adressen = place.adressen;
          var www = place.contacts.www;
          var phone = place.contacts.phone
          var day = place.founddate.day;
          var month = place.founddate.month;
          var year = place.founddate.year;
          var xml = place.xml;
          var insert = "<div style='margin-top:60px;' class='container'><div class='row'><div class='col-xs-12'><nav><ul class='pager'><li class='previous'><a onclick='back("+pid+")' style='color:#999999;border:0px;' class='back'>Назад</a></li><li style='text-align:center;'><h3 style='color:#999999;display:inline;font-family:roboto-thin;'>"+placename+"</h3></li><li class='next' style='visibility:hidden;'><a>Назад</a></li></ul></nav></div></div><div class='row'><div class='col-xs-12'><ul class='list-group' ><li style='padding:0px;text-align:center;background-color:inherit;border: 1px solid #4f4f4f;border-top-left-radius: 8px;border-top-right-radius: 8px;' class='list-group-item'><div id='pano' style='height:400px;'></div></li><li style='padding-bottom:15px;border:1px solid #4f4f4f;border-bottom:1px solid #4f4f4f;background-color:inherit;border-bottom-right-radius:8px;border-bottom-left-radius:8px;' class='list-group-item'><div class='alert alert-warning alert-dismissible' role='alert' style='margin-top:10px;margin-bottom:10px;color:#09bcf5;background-color:inherit;border-color:#09bcf5;'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><strong>Двойной щелчок для перехода в полноэкранный режим</strong></div><a class='away' href='"+www+"'>На сайт</a><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+adressru+"</h5><h5 style='color:#747474;font-size:15px;font-weight:bold;margin-bottom:5px;'>"+adressen+"</h5><a href='tel:"+phone+"'><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+phone+"</h5></a></li></ul></div></div></div>";
          $('#panel').append(insert);
          var pano = new pano2vrPlayer('pano');
          eval("pano.readConfigUrl('"+xml+"');");
          $('.pt-page-2').removeClass('pt-page-moveToRight');
          $('.pt-page-2').css('display','block').addClass('pt-page-moveFromRight pt-page-delay200 pt-page-ontop pt-page-current').css('overflow','auto');
          setTimeout(function(){$('.pt-page-1').removeClass('pt-page-current').css({'overflow':'hidden','visibility':'hidden'});},1000);
        }
        }
        }
        };
        request.open('POST', '/openpanel', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        request.send('pid='+pid);
        };

        function back(pid) {
           console.log('get back');
           $('.pt-page-1').css('visibility','visible');
           $('.pt-page-2').removeClass('pt-page-moveFromRight pt-page-ontop').addClass('pt-page-moveToRight');
           setTimeout(function(){$('.pt-page-2').removeClass('pt-page-current').empty().css('display','none');$('.pt-page').css('overflow','visible');},500);
           //eval("$('body').scrollTo('#p"+pid+"')");
           //$('.pt-page').css('overflow','visible');
           //$('pt-page').css('overflow','visible');
           //$('.pt-page-2').removeClass('pt-page-moveFromRight pt-page-ontop pt-page-current').addClass('pt-page-moveToRight');
        }

        