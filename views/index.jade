doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    // The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags
    title INTP Love
    // Bootstrap
    link(href='http://fonts.googleapis.com/css?family=Josefin+Sans&subset=latin,latin-ext', rel='stylesheet', type='text/css')
    link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')
    link(href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css', rel='stylesheet')
    meta(liber de amicitia est)
    meta(property="og:url"           content="http://intplove.com")
    meta(property="og:type"          content="website")
    meta(property="og:title"         content="INTP INTJ LOVE")
    meta(property="og:description"   content="Place to find your INTP or INTJ half")
    meta(property="og:image"         content="http://intplove.com/images/intplove_logo.png")
    // HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
    script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')
    script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')
    script(src='/js/share.js')
    style.
      body{
      background-image: linear-gradient(0deg, #080808, #333);
      padding-bottom:30px;
      }
      .header {
      text-align:center;
      }
      .header h1 {
      margin-top:50px;
      text-transform: uppercase;
      }
      .header h4 {
      margin-top:20px;
      margin-bottom:30px;
      text-transform: uppercase;
      font-weight: 200;
      color: #bbb;
      }
      .footer {
      text-align:center;
      bottom: 0;
      width: 100%;
      }
      .participate {
      text-align:center;
      margin-top:50px;
      margin-bottom:70px;
      }
      .language {
      position:absolute;
      top:20px;
      right:20px;
      }
      #apply {
      display:none;
      }
      #ru_cont {
      display:none;
      }
      .user {
      border-bottom:1px solid #eee;
      padding-top:20px;
      padding-bottom:20px;
      padding-left:10px;
      }
      .user h5 {
      margin-top:0px;
      }
      .user:last-child {
      border-bottom:none;
      }
      .emptyavatar {
      /*margin:30px;
      margin-left:50px;
      margin-right:50px;*/
      margin:auto;
      width:90px;
      height:90px;
      background-color:#eee;
      border-radius:50%;
      }
      #main {
      background-color:white;
      border-radius:6px;
      }
      #mainholder {
      border-radius:6px;
      }
      #head {
      border: 1px solid #232323;
      padding-bottom:30px;
      text-align:center;
      border-top-left-radius:6px;
      border-top-right-radius:6px;
      background-color:#222;
      }
      h1{
      font-family:Josefin Sans;
      text-align:center;
      margin-bottom:80px;
      letter-spacing: 12px;
      color: #222;
      font-size:80px; 
      }
      #avatars {
      text-align:center;
      padding-top:30px;
      padding-bottom:30px;
      border-bottom:1px solid #ddd;
      background-color:#232323;
      }
      #eng_cont {
      padding-top:45px;
      }
      .avatar {
        margin:auto;
        height:90px;
        width:90px;
      }
      .btn-send {
      margin-top:20px;
      margin-bottom:5px;
      }
      @media (min-width: 767px){
      .vcenter {
      display: flex;
      align-items: center;
      }
      .row {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display:         flex;
      }
      }
      @media (max-width: 767px) {
      .small_view {
        margin-top:0px;
        margin-left:20px;
      }
      a.small_view{
      margin-top:10px;
      }
      h6.visible-xs,h5.visible-xs,a.visible-xs {
        display:inline-block !important;
      }
      .emptyavatar {
        margin-left:10px;
        float:left !important;
      }
      .avatar{
        margin-left:10px;
        float:left !important;
      }
      .margin-xs {
        margin-top:30px;
      }
      #eng_cont {
      padding-top:0px;
      padding-bottom:30px;
      }
      #avatars {
        background-color:#333;
      }
      h1 {
        font-size:36px;
        margin-bottom:20px
      }
      .user {
        padding-left:0px;
      }
      #head {
      border: 1px solid #232323;
      border-top-left-radius:0px;
      border-top-right-radius:0px;
      }
      #mainholder{
        border-radius:0px;
      }
      #main {
        border-radius:0px;
      }
      }
      h6 {
      color:#ddd;
      }
      /*.pagination>.active>a, .pagination>.active>a:focus, .pagination>.active>a:hover, .pagination>.active>span, .pagination>.active>span:focus, .pagination>.active>span:hover {
      background-color:teal;
      border-color:teal;
      color:#333;
      }
      .pagination>li>a, .pagination>li>span {
      background-color:#333;
      border-color:teal;
      color:teal;
      }*/
      .user .col-xs-9 {
      padding-left:10px;
      }
      .user .col-xs-3 {
      text-align:center;
      }
      .glyphicon-map-marker {
        margin-right:5px
      }
      .loader {
      margin: 60px auto;
      margin-top:20%;
      font-size: 10px;
      position: relative;
      text-indent: -9999em;
      border-top: 1.1em solid rgba(255, 255, 255, 0.2);
      border-right: 1.1em solid rgba(255, 255, 255, 0.2);
      border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
      border-left: 1.1em solid #ffffff;
      -webkit-transform: translateZ(0);
      -ms-transform: translateZ(0);
      transform: translateZ(0);
      -webkit-animation: load8 1.1s infinite linear;
      animation: load8 1.1s infinite linear;
      }
      .loader,
      .loader:after {
        border-radius: 50%;
        width: 10em;
        height: 10em;
      }
      @-webkit-keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      @keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      .socialbtns .fa {
        width: 35px;
        height: 35px;
        margin-left:5px;
        margin-right:5px;
        background-color: transparent;
        color:#333;
        border-color:#333;
        padding-top: 11px;
        border-radius: 22px;
        -moz-border-radius: 22px;
        -webkit-border-radius: 22px;
        -o-border-radius: 22px;
        border:1px solid #333;
        transition: background-color 0.5s ease;
        margin-bottom: 5px;
      }
      .socialbtns .fa:hover {
        background-color:#fff;
        color:#333;
      }
      .regerr {
        margin-top:30px;
        margin-bottom:30px;
        text-align:center;
        display:none;
      }
      #resendveri {
        margin-top:30px;
        margin-bottom:30px;
        text-align:center;
        display:none;
      }
      a:focus, a:hover, a:active {
        color:#446179 !importnat;
        text-decoration:none !important;
      }
      #profile {
        margin-top:30px;
        border-bottom: 1px solid #323232;
        border-top: 1px solid #323232;
        text-align:center;
        display:none;
        transition:background-color 0.5 linear;
      }
      #profile a {
        color:#515558;
      }
      #profile .col-xs-3.active {
        background-color: #292929;
      }
      #profile .col-xs-3.active a {
      color:#3A6890;
      }
      #profile .col-xs-3:hover {
        background-color: #292929;
      }
      #user_search .form-control {
      border: 1px solid #555758;
      background-color: #424242 !important;
      color:white;
      }
      .badge {
      margin-left:5px;
      color:#ff9900;
      background-color: rgba(213, 136, 20, 0.3);
      border-radius: 4px;
      }
      .btn:focus {
        box-shadow:none;
        outline: none !important;
      }
      #bottomNav {
        font-size:20px;
      }
      #bottomNav .glyphicon {
        top:17px;
      }
      #bottomNav .active {
        background-color:#333;
        height:60px;
      }
      #bottomNav .glyphicon{
        top:0px;
        line-height:3;
      }
      #bottomNav .col-xs-3 {
        border-right:1px solid #333;
      }
      #bottomNav .col-xs-3:last-child {
        border-right:none;
      }
      .user p {
        color:#a9a9a9;
        text-align:justify;
      }
      .user h6 {
        font-weight:200;
        color: #CAC9C9;
      }
      .avatar-holder:before {    /* create a full-height inline block pseudo=element */
          content: ' ';
          display: inline-block;
          vertical-align: middle;  /* vertical alignment of the inline element */
          height: 100%;
      }
      .btn-send {
        border-color:#09F;
        color:#09F;
        font-size:11px;
        text-transform:uppercase;
      }
      .btn-send:hover{
        background-color:#09f;
        color:white;
      }
      #profile .col-xs-3 {
        border-right:1px solid #333;
        text-align:center;
        padding:10px;
      }
      #profile .col-xs-3:last-child {
        border-right:none;
      }
      form label {
        color:#555;
      }
      .btn-success {
        background-color:#00de82;
        border-color:#00de82;
      }
      .btn-success:hover, .btn-success:active, .btn-success:focus {
        background-color:#00BF70;
        border-color:#00BF70;
      }
      .btn-primary {
      color:white;
      background-color: #0080D6;
      border-color: #0062A5;
      }
      .btn-primary:hover, .btn-primary:active, .btn-primary:focus, .btn-primary.active, .btn-primary.active:active, .btn-primary.active:focus, .btn-primary.active:hover {
        background-color:#0062A5;
        border-color:#0062A5;
        color:white;
      }
      .btn-white {
        background-color:transparent;
        border-color:white;
        color:white;
        font-weight:400;
        text-transform:uppercase;
        letter-spacing:2px;
      }
      .btn-white:hover, .btn-white:active, .btn-white:focus, btn-white.active {
        background-color:white;
        border-color:white;
        color:#0080D6;
        font-weight:200;
      }
      .ui-autocomplete {
      z-index: 1060 !important;
      }
      .pac-container {
        z-index: 1060 !important;
      }
      .btn-default {
        background-color:transparent;
        border-color:#09f;
        color:#09f;
        font-weight:200;
        text-transform:uppercase;
        letter-spacing:2px;
      }
      .btn-default:hover, .btn-default:active, .btn-default:focus, .btn-default.active, .btn-default.active:active, .btn-default.active:focus, .btn-default.active:hover {
        background-color:#09f;
        border-color:#09f;
        color:white;
        font-weight:200;
      }
      .modal-body  {
        padding:0px;
      }
      .modal-body .form-control {
        border:none;
        border-bottom:1px solid #2F2F2F;
        color:white;
        background-color:#464646;
        height:50px;
        font-weight:500;
        box-shadow:none;
        border-radius:0px;
      }
      .modal-body .form-control:last-child {
        border:none;
      }
      .modal-body .form-group {
        margin:0px;
      }
      .modal-body label {
        display:none;
      }
      .modalbutton {
        background-color:#09f;
        border:none;
        color:white;
      }
      .pagination{
        /*padding-top:20px;
        padding-bottom:20px;*/
        text-align:center;
      }
      .pagination>.active>a, .pagination>.active>a:focus, .pagination>.active>a:hover, .pagination>.active>span, .pagination>.active>span:focus, .pagination>.active>span:hover {
       background-color: #DCDCDC;
       border-color: #DCDCDC;
      }
      .pagination>li>a, .pagination>li>span {
        color: #A7A7A7;
      }
  body
    //
      <div class='language'>
      <a id='eng' class='active'>ENG</a>
      <span style='color:#ddd;'>|</span>
      <a id='ru'>RU</a>
      </div>

      #notice(style='background-color:#ff9900;width:100%;position:absolute;top:0px; text-align:center;')
          h6(style='font-family:arial;text-transform:uppercase;letter-spacing:1px;color:#333;') Знакомства INTP INTJ.
            br 
            |Идет разработка, планируем запуститься до конца ноября 2015 года, заглядывайте на днях &#40;-:
          .socialbtns.fxd(style='margin:auto;margin-top:5px;margin-bottom:5px;')
            a(href="#" class="social_share fa fa-lg fa-vk" data-type='vk')
            a(href="#" class="social_share fa fa-lg fa-facebook" data-type='fb')
            a(href="#" class="social_share fa fa-lg fa-twitter" data-type='tw')
            a(href="#" class="social_share fa fa-lg fa-google-plus" data-type='gg')
    .modal.fade(id="sendmsg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel")
      .modal-dialog(role="document")
        .modal-content
          #sendmsg.modal-header
            button(type="button" class="close" data-dismiss="modal" aria-label="Close")
              span(aria-hidden="true") ×
            h4(class='modal-title' style='color:#ddd;') Sending a message
          .modal-body
            label Message:
            textarea(id='gettext' rows="3" maxlength="2700" class='form-control' style='margin-bottom:15px;')
          .modal-footer(style='text-align:center;')
            a.btn.btn-submit(id='submitmsg') Send
    #register.modal.fade(tabindex='-1', role='dialog', aria-labelledby='myModalLabel')
      .modal-dialog(role='document')
        .modal-content
          .modal-header(style='background-color:#383737;border-top-left-radius:6px;border-top-right-radius:6px;border-bottom: 1px solid #2F2F2F;')
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true')  ×
            h4.modal-title(style='color: #929292;font-weight: 200;')  Регистрация 
          .modal-body
            //
              .row.regerr
                .col-xs-12
                  h4#regerrtext
            .row
              .col-xs-12(style='text-align:center;padding: 0px;margin-left: 15px;margin-right: 15px;background-image: linear-gradient(90deg, #FF2E85, #00BFD2);')
                form
                  .form-group#uname_group
                    label(for='pagetitle') 1. Имя
                    input#uname.form-control(type='text' placeholder='name')
                    span(class="hidden err_indicator glyphicon glyphicon-remove form-control-feedback" aria-hidden="true")
                    span(class="hidden success_indicator glyphicon glyphicon-ok form-control-feedback" aria-hidden="true")
                  .form-group#email_group
                    label(for='email') 2. email 
                    input#email.form-control(type='email' placeholder='email' ) 
                    span(class="hidden err_indicator glyphicon glyphicon-remove form-control-feedback" aria-hidden="true")
                    span(class="hidden success_indicator glyphicon glyphicon-ok form-control-feedback" aria-hidden="true")
                  .form-group#pas_group
                    label(for='pagetitle') 3. Пароль
                    input#pas.form-control(type='password' placeholder='password')
                    span(class="hidden err_indicator glyphicon glyphicon-remove form-control-feedback" aria-hidden="true")
                    span(class="hidden success_indicator glyphicon glyphicon-ok form-control-feedback" aria-hidden="true")
                  .form-group#reg_location_group
                    label(for='pagetitle') 4. Город
                    input#reg_location.form-control(type='text' placeholder='city' )
                    span(class="hidden err_indicator glyphicon glyphicon-remove form-control-feedback" aria-hidden="true")
                    span(class="hidden success_indicator glyphicon glyphicon-ok form-control-feedback" aria-hidden="true")
                  .form-group#age_group
                    label(for='pagetitle') 5. Возраст
                    input#age.form-control(type='text' placeholder='age' )
                    span(class="hidden err_indicator glyphicon glyphicon-remove form-control-feedback" aria-hidden="true")
                    span(class="hidden success_indicator glyphicon glyphicon-ok form-control-feedback" aria-hidden="true")
                  .form-group#about_group
                    label(for='pagetitle') 6. О себе
                    textarea#about.form-control(autocomplete="off" placeholder='What do you do for living ? What are you interested in? Who are you looking for?')
                    span(class="hidden err_indicator glyphicon glyphicon-remove form-control-feedback" aria-hidden="true")
                    span(class="hidden success_indicator glyphicon glyphicon-ok form-control-feedback" aria-hidden="true")
                  .btn-group(style='margin-top:10px;margin-bottom:10px;')
                    button(type='button' class='btn btn-white active' id='female') Female
                    button(type='button' class='btn btn-white' id='male') Male
          .modal-footer(style='background-color:#333;border-bottom-left-radius:6px;border-bottom-right-radius:6px;border-color:#383737;')
            button.btn.btn-success.modalbutton#regbutton  Регистрация
    #login.modal.fade(tabindex='-1', role='dialog', aria-labelledby='myModalLabel')
      .modal-dialog.modal-sm(role='document')
        .modal-content
          .modal-header(style='background-color:#828282;border-top-left-radius:6px;border-top-right-radius:6px;')
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true')  ×
            h4.modal-title(style='color:#ddd;')  Вход 
          .modal-body(style='text-align:center;')
            form
              .form-group
                label(for='email')  email
                input#mail.form-control(type='email', autocomplete='off', placeholder='email')
              .form-group
                label(for='pagetitle')  Пароль
                input#p.form-control(type='password', autocomplete='off', placeholder='password')
          .modal-footer
            button.btn.btn-primary.modalbutton#loginbutton(type='button')  Войти
    .container(id='wait' style='background-color:rgba(0, 0, 0, 0.63);position:fixed;width:100%;height:100%;z-index:9999;display:none;')
        .row(id='spin') 
          .col-xs-12(style='text-align:center;')
            .loader
    .container-fluid(style='text-align:center;')
      .row 
        .col-xs-12
          h5(style='font-family:arial;text-transform:uppercase;letter-spacing:2px;') Знакомства intp intj 
    #eng_cont.container
      //
        <div class='language'>
        <a class='active eng'>ENG</a>
        <span style='color:#ddd;'>|</span>
        <a class='ru'>RU</a>
        </div>
      //
        <div class='page-header header'>
        <h1><span><img src='images/cfrp.png' width='40'></span></h1>
        <h1>Consciousness:<br> essential components & infrastructure</h1>
        <h4 > Research project</h4>
        </div>
      .row
        .col-xs-12
          h1 INTPLOVE
      #mainholder.row
        #main.col-xs-12.col-sm-8.col-sm-offset-2.col-md-6.col-md-offset-3.col-lg-6.col-lg-offset-3
          #head.row
            .col-xs-12
              #profile.row.hidden-xs
                .col-xs-3.active
                  a(href='#')
                    span(class='glyphicon glyphicon-search' style='margin-right:5px;') 
                    | Поиск
                .col-xs-3(onclick="location='/profile';")
                  a(href='/profile')
                    span(class='glyphicon glyphicon-user' style='margin-right:5px;') 
                    | Профиль
                .col-xs-3(onclick="location='/messages';")
                  a#messages(href='/messages') 
                    span(class='glyphicon glyphicon-envelope' style='margin-right:5px;') 
                    | Почта
                .col-xs-3(onclick="location='/logout';")
                  a(href='/logout') 
                    span(class='glyphicon glyphicon-log-out' style='margin-right:5px;') 
                    | Выйти
              h5(style='color:gray;text-align:center;margin-bottom:20px;margin-top:30px') Я ищу
              form#user_search
                .btn-group.btn-group-sm#gender_search
                  button.btn.btn-primary#male_search(type='button') Парня
                  button.btn.btn-primary#female_search(type='button') Девушку
                  button.btn.btn-primary.active#all_search(type='button') Всех
                h5(style='color:gray;margin-top:20px;')
                  | от 
                  input(type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' maxlength='2' class='form-control' id='agefrom' style='max-width:50px;display:inline;margin-left:10px;margin-right:10px;')           
                  | до
                  input(type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' maxlength='2' class='form-control' id='ageto' style='max-width:50px;display:inline;margin-left:10px;margin-right:10px;')
                  |             лет
                h5(style='color:gray;') в городе
                input#user_location(type='text' style='max-width:500px;margin:auto;' class='form-control')
                h5(style='color:gray;font-weight:200;') (просто указывайте параметры, результаты обновятся автоматически)
          //.row#regrow(style='padding-top:10px;padding-bottom:10px;text-align:center;border-bottom: 1px solid #333;background-image: linear-gradient(45deg, #E80040, #2095D4);border-top-left-radius:6px;border-top-right-radius:6px;')
          .row#regrow(style='padding-top:20px;padding-bottom:20px;text-align:center;background-image: linear-gradient(90deg, #FF7B2E, #00D2A1);')
            .col-xs-12
              .btn-group.btn-group-sm
                button#showregbutton(type='button' class='btn btn-white') Регистрация
                button#showloginbutton(type='button' class='btn btn-white') Вход
              h5(style='font-weight:200;display:none;')
                a(style='margin-right:10px;') Регистрация
                | &#124;
                a(style='margin-left:10px;')  Вход
          .row#resendveri(style='text-align:center;background-image: linear-gradient(90deg, rgb(255, 0, 105), #00A3BF);padding-top:10px;padding-bottom:20px;')
            .col-xs-12
              h4(style='font-weight:200;color:white;') Пройдите по ссылке в письме, чтобы активировать аккаунт
              button#resendconf.btn.btn-white(type='button' style='margin-top:20px;') Письмо не пришло 
          .row.pagination
            .col-xs-12#page-selection-top
          .row
            .col-xs-12#user_insert
          .row.pagination
            .col-xs-12#page-selection-bottom
    #ru_cont.container(style='display:none;')
    footer.footer.hidden-xs
      .container
        .row
          .col-xs-12
            .socialbtns.fxd(style='margin:auto;margin-top:40px;margin-bottom:5px;')
              a(href="#" class="social_share fa fa-lg fa-vk" data-type='vk')
              a(href="#" class="social_share fa fa-lg fa-facebook" data-type='fb')
              a(href="#" class="social_share fa fa-lg fa-twitter" data-type='tw')
              a(href="#" class="social_share fa fa-lg fa-google-plus" data-type='gg')
            h6(style='font-weight:200;color:#333;') INTPLOVE 2015
            a(style='margin-bottom:30px;font-weight:200;', href='mailto:feedback@intplove.ru') Contact us
    footer.visible-xs(style='height:60px;width:100%;position:fixed;bottom:0px;background-color:#232323;')
      .col-xs-12.navbar-inverse.navbar-fixed-bottom
      .row#bottomNav
        .col-xs-3.text-center.active
          a(href="#") 
            i(class="glyphicon glyphicon-search")
            //
              br 
              |Поиск
        .col-xs-3.text-center(onclick="location='/profile';")
          a(href="/profile") 
            i(class="glyphicon glyphicon-user")
            //
              br 
              |Профиль
        .col-xs-3.text-center(onclick="location='/messages';")
          a(href="/messages") 
            i(id='envelope' class="glyphicon glyphicon-envelope")
            //
              br 
              |Сообщения
        .col-xs-3.text-center(onclick="location='/logout';")
          a(href="/logout") 
            i(class="glyphicon glyphicon-log-out")
            //
              br 
              |Выход
    // jQuery (necessary for Bootstrap's JavaScript plugins)
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js')
    // Include all compiled plugins (below), or include individual files as needed
    //script(src='/js/jquery.min.js')
    script(src='js/bootstrap.min.js')
    script(type="text/javascript" src="js/jquery.bootpag.min.js")
    script(src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8lRm1SQ5qlhTnvAAwX5Y8mO-P9qq8HfQ&signed_in=true&libraries=places&callback=initialize" async defer)
    script.
      var first_input_user_location=0;
      var second_input_user_location = 0;
      var second_input_user_location_name = 0;
      $(document).keypress(function(e) { 
          if(e.which ==13 && validateEmail($('#mail').val()) && $('#p').val() && $('#login').css('display') === 'block') {
              authsubmit();
          }
          if(e.which ==13 && $('#register').css('display') === 'block') {
            runreg();
          }
      });
      $(document).on('click', '.social_share', function(){
          Share.go(this);
      });
      $('#male_search').click(function(){
        if(!$('#male_search').hasClass('active')){
         $('#gender_search .btn').removeClass('active');
         $('#male_search').addClass('active');
         pgnt(0);
        }
        });
      $('#female_search').click(function(){
        if(!$('#female_search').hasClass('active')){
         $('#gender_search .btn').removeClass('active');
         $('#female_search').addClass('active');
         pgnt(0);
        }
        });
      $('#all_search').click(function(){
        if(!$('#all_search').hasClass('active')){
         $('#gender_search .btn').removeClass('active');
         $('#all_search').addClass('active');
         pgnt(0);
        }
        });
      $('#male').click(function(){
        if($('#male').hasClass('active')){
        }
        else{
          $('#male').addClass('active');
          $('#female').removeClass('active');
        }
        });
      $('#female').click(function(){
        if($('#female').hasClass('active')){
        }
        else{
          $('#female').addClass('active');
          $('#male').removeClass('active');
        }
        });
      $('#showloginbutton').click(function(){
      $('#login').modal('show');
      });
      $('#showregbutton').click(function(){
      $('#register').modal('show');
      });
      $('#regbutton').click(function(){
        runreg();
        });
      //var userlist = !{JSON.stringify(done)};
      //if(userlist) {
      //  userlist.forEach( function (element,index){
      //    var insert="<div class='row user'><div class='col-xs-3'><div class='emptyavatar'></div><a class='btn btn-sm btn-send btn-default>Написать</a></div><div class='col-xs-9'><h5>"+element.name+"</h5><h6><span class='glyphicon glyphicon-map-marker'></span>"+element.city+"</h6></div></div>";
      //    $('#main').append(insert);
      //    });
      //}
      var user = !{JSON.stringify(user)};
      if(user){
        console.log(1);
        $('#regrow').css('display','none');
        if(!user.confirmed) {
          console.log(2);
          $('#resendveri').css('display','block');
        }
        else {
          $('#profile').css('display','block');
        }
      }
      var user_arr = [];
      //###################################################//
      console.log('gonna request users');
      //$.ajax({
      //       method: "POST",
      //       url: "/getusers",
      //       data: 0
      //     })
      //       .done(function( msg ) {
      //        populate(msg);
      //         });
      pgnt(0);
      //###################################################//
      function populate (msg) {
        if(msg.userlist && msg.userlist.length){
              $('.user').remove();
              msg.userlist.forEach( function (element,index){
                  if(element.confirmed )
                 {
                  user_arr.push(element);
                  var num = user_arr.length-1;
                  //var insert="<div class='row user'><div class='col-xs-3 col-md-3'><div class='emptyavatar'></div><a class='btn btn-sm btn-send btn-default visible-xs'>Написать</a></div><div class='col-xs-9 col-md-6 '><h5>"+element.name+"</h5><h6><span class='glyphicon glyphicon-map-marker'></span>"+element.city+"</h6><p>"+element.about+"</p></div><div class='col-md-3 hidden-xs'><a class='btn btn-sm btn-send btn-default'>Написать</a></div></div>";
                  var onlick='opensend('+num+')';
                  if(!user) {
                  var onlick='openreg()';
                  }
                  var avatar_insert = "<div class='emptyavatar'></div><h5 class='visible-xs small_view'>"+element.name+", "+element.age+"</h5><br><h6 class='visible-xs small_view'><span class='glyphicon glyphicon-map-marker'></span>"+element.city_name+"</h6><br><a class='btn btn-sm btn-send visible-xs small_view' onclick='"+onlick+"' style='max-width:85px;'>Написать</a>";
                  if(element.userpic) {
                    avatar_insert = "<img id='avatar' class='img-circle avatar' src='/userpics/"+element._id+".png''></img><h5 class='visible-xs small_view'>"+element.name+", "+element.age+"</h5><br><h6 class='visible-xs small_view'><span class='glyphicon glyphicon-map-marker'></span>"+element.city_name+"</h6><br><a class='btn btn-sm btn-send visible-xs small_view' onclick='"+onlick+"' style='max-width:85px;'>Написать</a>";
                  }
                  var margin_insert = element.about ? 'margin-xs' : '';
                  var insert="<div class='row user'><div class='col-sm-3 vcenter'>"+avatar_insert+"</div><div class='col-sm-6'><h5 class='hidden-xs'>"+element.name+", "+element.age+"</h5><h6 class='hidden-xs'><span class='glyphicon glyphicon-map-marker'></span>"+element.city_name+"</h6><p style='text-align:left;' class='"+margin_insert+"'>"+element.about+"</p></div><div class='col-sm-3' style='text-align:center;'><a class='btn btn-sm btn-send hidden-xs' onclick='"+onlick+"' style='max-width:85px;'>Написать</a></div></div>";
                  if(user && user.email && element.email === user.email){
                    insert='';
                  }
                  //$('#main').append(insert);}
                  $('#user_insert').append(insert);}
                 });
            }
            else {
              $('.user').remove();
              var insert = "<div class='row user' style='padding-top:50px;padding-bottom:50px;text-align:center;'><div class='col-xs-12'><h3 style='color:#ddd;'>Никого не нашли</h3></div></div>";
              //$('#main').append(insert);
              $('#user_insert').append(insert);
            }
      }
      $('.btn-send').click(function(){
      $('#register').modal('show');
      });
      $('#applybutton_eng').click(function(){
      $('#apply_eng').modal('show');
      });
      $('#applybutton_ru').click(function(){
      $('#apply_ru').modal('show');
      });
      $('#ru').click(function(){
      console.log('hey');
      if(!$('#ru').hasClass('active')){
      console.log('double hey');
      $('#eng_cont').css('display','none');
      $('#ru_cont').css('display','block');
      $('#eng').removeClass('active');
      $('#ru').addClass('active');
      }
      });
      $('#eng').click(function(){
      console.log('hey');
      if(!$('#eng').hasClass('active')){
      console.log('double hey');
      $('#ru_cont').css('display','none');
      $('#eng_cont').css('display','block');
      $('#ru').removeClass('active');
      $('#eng').addClass('active');
      }
      });
      function opensend (index) {
        console.log(user_arr[index]._id);
        var onclick = "sendmsg("+index+")";
        $('#submitmsg').attr('onclick',onclick);
        $('#sendmsg').modal('show');
      }
      function openreg (index) {
        $('#register').modal('show');
      }
      function runreg() {
         if ($('#uname').val() && $('#pas').val() && validateEmail($('#email').val()) && $('#email').val() && second_input_user_location && second_input_user_location_name && $('#age').val())
        {
          //if($('.regerr').css('display') === 'block') {
          //  $('.regerr').slideToggle();
          //}
        var male=2;
        if($('#male').hasClass('active')) {
          male=1;
        }
        var about = 0;
        if($('#about').val())
        {
          about = $('#about').val();
        }
        $('#wait').css('display','block');
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        // do your job here
        if (parsed.trouble === 1)
        {
        $('.message').empty();
        switch (parsed.mtext)
        {
        case('fail'):
        //$('.message').append("<h5 style='color:#fc454e;'>Sorry, omething is slightly off with the DB, try again in a couple of minutes or contact support</h5>");
        $('#error_text').text('Network Error');
        $('#error_Modal').modal('show');
        break;
        case('email exists'):
        //$('.message').append("<h5 style='color:#fc454e;'>Provided email is already used by one of the users</h5>");
        $('#error_text').text('email_inuse');
        $('#error_Modal').modal('show');
        break;
        
        }
        }
        else {
        // window.location = 'http://intplove.com';
        $('#register .modal-body').empty().append("<div class='row'><div class='col-xs-12'><h3 style='padding-top:30px;'>We have sent you a letter</h3><h4 style='padding-bottom:30px;'>Follow the link in that letter to activate your account</h4></div></div>");
        }
        }
        };
        request.open('POST', '/new', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        // Most libraries like jQuery/Prototype/Dojo do this
        request.send("uemail="+$('#email').val()+"&p="+$('#pas').val()+"&ugen="+male+"&uage="+$('#age').val()+"&ucity="+second_input_user_location+"&ucity_name="+second_input_user_location_name+"&uabout="+about+"&uname="+$('#uname').val());
        }
        else {
            console.log('making a hint');
            $('.form-group').removeClass('has-feedback has-error');
            $('.err_indicator').addClass('hidden');
            if(!$('#uname').val())
            {$('#uname_group').addClass('has-feedback has-error');
             $('#uname_group .err_indicator').removeClass('hidden');
            }
            
            if(!$('#pas').val() )
            {$('#pas_group').addClass('has-feedback has-error');
             $('#pas_group .err_indicator').removeClass('hidden');
            }
            
            if(!$('#email').val() )
            {$('#email_group').addClass('has-feedback has-error');
             $('#email_group .err_indicator').removeClass('hidden');
             }
            
            if(!validateEmail($('#email').val()) )
            { $('#email_group').addClass('has-feedback has-error');
              $('#email_group .err_indicator').removeClass('hidden');
             }
            
            if(!second_input_user_location )
            {console.log(second_input_user_location);
              $('#reg_location_group').addClass('has-feedback has-error');
             $('#reg_location_group .err_indicator').removeClass('hidden');
            }
            
            if(!second_input_user_location_name )
            {console.log(second_input_user_location_name);
              $('#reg_location_group').addClass('has-feedback has-error');
             $('#reg_location_group .err_indicator').removeClass('hidden');
            }
            
            if(!$('#age').val())
            {$('#age_group').addClass('has-feedback has-error');
             $('#age_group .err_indicator').removeClass('hidden');
             }
            
          //$('.regerr').slideToggle();
          }
        }
        //sonorous-shore-113306
        function initialize() {
         var options = {
          types: ['(cities)'],
          componentRestrictions: {}
         };
         var input1 = document.getElementById('user_location');
         var autocomplete = new google.maps.places.Autocomplete(input1, options);
         google.maps.event.addListener(autocomplete, 'place_changed', function(){
           //# $('.your-input').val() to get the value from your input
           var place = autocomplete.getPlace();
           console.log(place);
           first_input_user_location = place.place_id ;
         });
         var input2 = document.getElementById('reg_location');
         var reg_location = new google.maps.places.Autocomplete(input2 , options);
        google.maps.event.addListener(reg_location, 'place_changed', function() {
          //fillInAddress();
          var place = reg_location.getPlace();
          console.log(place.place_id);
          second_input_user_location = place.place_id ;
          second_input_uuser_location_name = place.address_components[0].long_name;
        });
        pgnt(0);
        }
         function validateEmail(email) { 
        console.log('checking email');
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);} 
        //--------------------
        // AUTHSUBMIT FUNCTION
        //--------------------
        var allowauth = 1;
        function authsubmit() {
        allowauth = 0;
        var vlgn = $('#mail').val();
        var vphr = $('#p').val();
        console.log(vlgn +" , "+vphr);
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        var index;
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        if(parsed.trouble === 1)
        {
        console.log('TROUBLE === 1');
        }
        else {
          if(!parseInt(parsed.confirmed)) {
           $('#regrow').css('display','none');
           $('#resendveri').css('display','block');
          }
           else {window.location = 'http://intplove.com';}
        }
        }
        };
        request.open('POST', '/signin', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        request.send("phr="+vphr+"&lgn="+vlgn);
        }
        //END OF AUTHSUBMIT FUNCTION
        $('#loginbutton').click(function(){
          authsubmit();
          });
        $('#resendconf').click(function(){
         if(user)
         {$.ajax({
             method: "POST",
             url: "/reveri",
             data: "email="+user.email
           })
             .done(function( msg ) {
               if(msg.trouble){
                alert(msg.mtext);
               }
               else {
                $('#resendveri h4').text('').append('Проверьте свой почтовый ящик. Если возникли проблемы, напишите нам <br><a href="mailto:feedback@intp.com">Поддержка</a>');
                $('#resendconf').attr('disabled',true).text('Отправили еще одно письмо');
                console.log('check your mailbox');
               }
               });
          }
          });
        //$('#submitmsg').click(function(){sendmsg()});
        function sendmsg(index) {
        console.log('msg sendin'); 
        //var rcvr = #{rcvrid}; 
        var sndr = '#{user}';
        var txtbody = $('#gettext').val();
        if(!txtbody) {
          return 0
        }
        console.log(txtbody);
        sndrequest = new XMLHttpRequest();
        sndrequest.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if(sndrequest.readyState==4 && sndrequest.status==200){
        $('#gettext').val('');
        $('#sendmsg').modal('hide');
        //if (this.readyState === DONE){
        var parsed = JSON.parse(sndrequest.responseText);
        if(parsed.trouble === 1)
        {
        // TO DO do somewthing here
        alert('trouble');
        }
        else {
        }
        }
        };
        sndrequest.open('POST', '/msg', true);
        sndrequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        sndrequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        sndrequest.send('rcvr='+user_arr[index]._id+'&txtbody='+txtbody);
        }
        //###################################################//
        $.ajax({
              method: "POST",
              url: "/ntfc_m",
              data: 0
            }).done(function( msg ) {
                if(msg.newmsg){
                  console.log(msg.newmsg);
                 $('#messages').append('<span class="badge">+'+msg.newmsg+'</span>');
                 $('#envelope').css('color','#ff9900');
                }
               });
        //###################################################//
        //$.ajax({
        //      method: "POST",
        //      url: "/usercount",
        //      data: 0
        //    }).done(function( msg ) {
        //        if(msg && msg.count){
        //           console.log('###########  '+msg.count+'  ############');
        //           if(parseInt(msg.count) <11) {
        //            $('.pagination').css('display','none');
        //           }
        //           else
        //           {
        //              var pag_num = (parseInt(msg.count)-parseInt(msg.count)%10)/10;
        //              if(parseInt(msg.count)%10){pag_num++;}
        //              $('#page-selection-top, #page-selection-bottom').bootpag({
        //                    total: pag_num
        //                }).on("page", function(event, /* page number here */ num){
        //                     //$("#content").html("Insert content"); // some ajax content loading...
        //                     console.log('requesting page of users');
        //                     pgnt(num);
        //                });
        //            }
        //        }
        //       });
        //###################################################//
        //search
        $("#agefrom").change(function() {
        console.log('something is on');
        pgnt(0);
        });
        $("#ageto").change(function() {
        console.log('something is on');
        pgnt(0);
        });
        //function run_search() {
        //  var gender;
        //  if($('#male_search').hasClass('active')){
        //    gender = 1;
        //  }
        //  else if($('#female_search').hasClass('active')){
        //    gender = 2;
        //  }
        //  else {
        //    gender =0;
        //  }
        //  var agefrom = $('#agefrom').val() ? $('#agefrom').val() :0;
        //  var ageto = $('#ageto').val() ? $('#ageto').val() :0;
        //  $.ajax({
        //      method: "POST",
        //      url: "/search",
        //      data: "gender="+gender+"&agefrom="+agefrom+"&ageto="+ageto+"&user_location="+user_location
        //    }).done(function( msg ) {
        //        //populate(msg)
        //        populate(msg);
        //       });
        //  }
          function pgnt(p_num) {
          var gender;
          if($('#male_search').hasClass('active')){
            gender = 1;
          }
          else if($('#female_search').hasClass('active')){
            gender = 2;
          }
          else {
            gender =0;
          }
          var agefrom = $('#agefrom').val() ? $('#agefrom').val() :0;
          var ageto = $('#ageto').val() ? $('#ageto').val() :0;
          $.ajax({
              method: "POST",
              url: "/pgnt/"+p_num,
              data: "gender="+gender+"&agefrom="+agefrom+"&ageto="+ageto+"&user_location="+second_input_user_location
            }).done(function( msg ) {
                if(msg.init&&parseInt(msg.init_num) <11) {
                    $('.pagination').css('display','none');
                    populate(msg);
                   }
                   else if(msg.init&&parseInt(msg.init_num) >10)
                   {
                      var pag_num = (parseInt(msg.init_num)-parseInt(msg.init_num)%10)/10;
                      if(parseInt(msg.init_num)%10){pag_num++;}
                      $('#page-selection-top, #page-selection-bottom').empty;
                      $('#page-selection-top, #page-selection-bottom').bootpag({
                            total: pag_num
                        }).on("page", function(event, /* page number here */ num){
                             //$("#content").html("Insert content"); // some ajax content loading...
                             console.log('requesting page of users');
                             pgnt(num);
                        });
                        populate(msg);
                    }
                  else if(!msg.init) {
                    populate(msg);
                  }
               });
          }

          

