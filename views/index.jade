doctype html(lang='en')
head
    meta(charset='utf-8')
    |     
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    |     
    meta(name='viewport', content='width=device-width, initial-scale=1')
    |     
    title R
    // Bootstrap
    link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')
    script(src="https://cdnjs.cloudflare.com/ajax/libs/slideout/0.1.9/slideout.min.js")
    meta(liber de amicitia est)
    meta(property="og:url"           content="http://recentones.com")
    meta(property="og:type"          content="website")
    meta(property="og:title"         content="Recent ones")
    meta(property="og:description"   content="New restaurants in Moscow")
    meta(property="og:image"         content="http://recentones.com/bootstrap/images/rl.png")
    // HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
    script(src='/js/share.js')
    script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')     
    script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')     
    style.
      body {
        width: 100%;
        height: 100%;
        font: 100%/1.4em 'Calibre Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size:14;
      }
      .slideout-menu {
        background-color: #1D1F20;
        background-image: linear-gradient(145deg, #1D1F20, #404348);
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        z-index: 0;
        width: 256px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        display: none;
      }
      .slideout-panel {
        position:relative;
        z-index: 1;
      }
      .slideout-open,
      .slideout-open body,
      .slideout-open .slideout-panel {
        overflow: hidden;
      }
      .slideout-open .slideout-menu {
        display: block;
      }
      .menu a {
        color: #fff;
      }
      .menu a:hover {
        text-decoration: underline;
      }
      .menu-header {
        border-bottom: 1px solid #2a2d2f;
        padding: 20px 0 20px 60px;
        background-size: 32px;
      }
      .menu-header-title {
        font-weight: 600;
        letter-spacing: 0.5px;
        margin: 0;
        font-size:18;
      }
      .menu-section {
        margin: 25px 0;
      }
      .menu-section-title {
        text-transform: uppercase;
        color: #85888d;
        font-weight: 200;
        font-size: 13px;
        letter-spacing: 1px;
        padding: 0 20px;
        margin:0;
      }
      .menu-section-list {
        padding:0;
        margin: 10px 0;
        list-style:none;
      }
      .menu-section-list a {
        font-family:boldproxima;
        text-transform: uppercase;
        color: #85888d;
        font-weight: 200 !important;
        font-size: 20px !important;
        letter-spacing: 1px;
        display: block;
        padding: 20px 20px;
      }
      .menu-section-list a:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color:#fff !important;
        text-decoration: none;
      }
        @font-face {
      font-family:high;
      src: url('/bootstrap/fonts/Attentica.ttf');
      }
      @font-face{
      font-family:proxima;
      src:url('/bootstrap/fonts/ProximaNova-Reg-webfont.woff');
      }
      @font-face{
      font-family:boldproxima;
      src:url('/bootstrap/fonts/ProximaNova-Sbold-webfont.woff');
      }
      #inserts h5{
      letter-spacing:2px;
      text-transform:uppercase;
      margin-bottom:0px;
      color:white;
      font-family:roboto-thin;
      font-size:30px;
      margin-top:0px;
      }
      #inserts h2 {
      letter-spacing:2px;
      text-transform:uppercase;
      font-family:high;
      margin-bottom:0px;
      }
      #inserts h6{
      font-family:roboto-thin; 
      text-transform:uppercase;
      margin-top:0px;
      color:lightgray;
      margin-bottom:0px;
      letter-spacing:2px;
      }
      .col-lg-4 {
      margin-bottom: 20px;
      text-align: center;
      }
      .list-group-item:last-child {
      border-bottom: 2px solid #c2c2c2;
      }
      .away {
        display: inline-block;
        padding: 5px 14px;
        background-color: #4F4F4F; 
        border-radius:15px;
        margin-bottom:10px;
        color:#999999;
      }
      .away:hover {
      text-decoration: none;
      color:#09BCFD;
      }
      .back {
        background-color:#4F4F4F !important;
      }
      .previous:hover{
        border:1 px solid #09bcf5
        color:#09bcf5;
      }
      #wrap a:hover{
        text-decoration:none;
        color:#09BCFD !important;
      }
      #pano canvas {
        border-top-left-radius:8px;
        border-top-right-radius:8px;
        z-index:600;
      }
      :-webkit-full-screen-ancestor:not(iframe) {
       z-index: 5000 !important;
      }
      .list-group {
        cursor:pointer;
      }
      #menu-toggle {
      background-color: transparent;
      border: none;
      position: absolute;
      top: 20px;
      left: 20px;
      color: #333;
      font-size: 30;
      }
      button:focus,button:active {
       outline: none !important;
      }
  body
    nav#menu.menu 
      section.menu-section
        ul.menu-section-list    
          li
            a(href="/" ) My lists
          li
            a(href="/people" ) People
          li 
            a(href='/messages' ) Messages
          li
            a(href="/settings" ) Settings
          li
            a(href="/logout") Logout
    .container-fluid#panel.main(style='padding-top:50px;min-height:100vh;background-color:white;')
      button(type='button' ,id='menu-toggle')
        span.glyphicon.glyphicon-menu-hamburger
      .row(style='text-align:center;margin-bottom:50px;')
        h1(style='text-transform:uppercase;font-weight:600;letter-spacing:2px;') Recent ones
        h5(style='text-transform:uppercase;letter-spacing:1px;font-weight:200;') медиа проект: новые участники ресторанного рынка москвы
      .row
        #inserts.col-xs-12
      footer(class='footer main' id='morebutton' style='display:none;background-color:white;')
        .container
            nav
              ul(class='pager') 
                li 
                  a(id='more',style='font-family:roboto-thin;') Еще
      script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js')
      script(src='/transitions/modernizr.custom.js')
      script(src='/transitions/pagetransitions.js')
      script(async src='/js/bootstrap.min.js')
      script( async, type='text/javascript', src='/js/pano2vr_player.js')
      script.
        var slideout = new Slideout({
        'panel': document.getElementById('panel'),
        'menu': document.getElementById('menu'),
        'padding': 256,
        'tolerance': 70
        });
        document.querySelector('#menu-toggle').addEventListener('click', function() {
          slideout.toggle();
        });
        $(document).on('click', '.social_share', function(){
            Share.go(this);
        });
        var rownum = 0;
        var lastfounddate;
        var more = #{more};
        if(more===1){
         $('#morebutton').css('display','block');
        }
        $('#close').click(function(){
          $("#welcome").css("display","none");
          $('.main').css({'filter':' brightness(1)','-o-filter':' brightness(1)','-moz-filter':' brightness(1)','-ms-filter':' brightness(1)','-webkit-filter':' brightness(1)'});
        });
        var toplist = !{doc};
        //scrolltoplaugin
        $.fn.scrollTo = function( target, options, callback ){
          if(typeof options == 'function' && arguments.length == 2){ callback = options; options = target; }
          var settings = $.extend({
            scrollTarget  : target,
            offsetTop     : 50,
            duration      : 500,
            easing        : 'swing'
          }, options);
          return this.each(function(){
            var scrollPane = $(this);
            var scrollTarget = (typeof settings.scrollTarget == "number") ? settings.scrollTarget : $(settings.scrollTarget);
            var scrollY = (typeof scrollTarget == "number") ? scrollTarget : scrollTarget.offset().top + scrollPane.scrollTop() - parseInt(settings.offsetTop);
            scrollPane.animate({scrollTop : scrollY }, parseInt(settings.duration), settings.easing, function(){
              if (typeof callback == 'function') { callback.call(this); }
            });
          });
        }
        //end of scrollto plugin
        //another scroll fn
        function scrollfn (element){
        $('.wrap').animate({
            scrollTop: $(element).parent().scrollTop() + $(element).offset().top - $(element).parent().offset().top}, {
            duration: 1000,
            specialEasing: {
                width: 'linear',
                height: 'easeOutBounce'
            },
            complete: function (e) {
                console.log("animation completed");
            }
        });}
        //and of the scroll fn
        function populate (toplist,funcmore) {
        for(var xx= 0;xx<toplist.length;xx++)
         {$('#inserts').append("<div class='row' style='margin-top:15px;margin-bottom:15px;' id='row"+xx+"'></div>");
                   var insert = "<div class='col-md-6 col-md-offset-3' id='p"+toplist[xx].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[xx].mainpreview+"' ></a></li></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[xx].placenameru+"</h2><h6>"+toplist[xx].founddate.day+"."+toplist[xx].founddate.month+"."+toplist[xx].founddate.year+"</h6></li></ul></div>";
                     eval("$('#row"+xx+"').append(insert);");
                   lastfounddate=toplist[xx].founddateint;}
        if(funcmore===0){
          $('#morebutton').css('display','none');
        }
        }
        function populate2(toplist,funcmore) {
          var left = toplist.length%2;
          var cycles = (toplist.length-left)/2;
          console.log('cycles: '+cycles+', left: '+left);
          //functionality for a single item array must be implemented
          if(funcmore===0)
          {for(var xx=0;xx<cycles;xx++){
                      console.log('rownum is: '+rownum);
                      $('#inserts').append("<div class='row' style='margin-top:15px;margin-bottom:15px;' id='row"+rownum+"'></div>");
                      //branch for outputting left
                      if(xx+1 === cycles && left) {
                        var modrownum = rownum+1;
                        $('#inserts').append("<div class='row' style='margin-top:15px;margin-bottom:15px;' id='row"+modrownum+"'></div>");
                        var insert = "<div class='col-xs-6' id='p"+toplist[xx].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[xx].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[xx].mainpreview+"' ></a></li></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[xx].placenameru+"</h2><h6>"+toplist[xx].founddate.day+"."+toplist[xx].founddate.month+"."+toplist[xx].founddate.year+"</h6></li></ul></div>";
                          eval("$('#row"+rownum+"').append(insert);");
                        lastfounddate=toplist[xx].founddateint;
                        $('#morebutton').css('display','none');
                      }
                      else {
                        
                          for(var yy=0;yy<2;yy++){
                          if(yy===0)
                          {var listnum = xx*2;
                           var insert = "<div class='col-xs-6' id='p"+toplist[listnum].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[listnum].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[listnum].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[listnum].placenameru+"</h2><h6>"+toplist[listnum].founddate.day+"."+toplist[listnum].founddate.month+"."+toplist[listnum].founddate.year+"</h6></li></ul></div>";
                           eval("$('#row"+rownum+"').append(insert);");}
                          else {
                            var listnum = xx*2+1;
                           var insert = "<div class='col-xs-6' id='p"+toplist[listnum].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[listnum].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[listnum].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[listnum].placenameru+"</h2><h6>"+toplist[listnum].founddate.day+"."+toplist[listnum].founddate.month+"."+toplist[listnum].founddate.year+"</h6></li></ul></div>";
                           eval("$('#row"+rownum+"').append(insert);");
                           lastfounddate=toplist[listnum].founddateint;
                          }
                          }//for populating row
                      
                      }//else from outputting left
                      rownum++;
                      console.log('rownum is: '+rownum);
                    }//for main cycle
                
                  }
          else {
             if(toplist.length>1){for(var xx=0;xx<cycles;xx++){
                                   console.log('MORE rownum is: '+rownum);
                                   var greatInsert ="<div class='row' style='margin-top:15px;margin-bottom:15px;display:none;' id='row"+rownum+"'>";
                                   
                                   //branch for outputting left
                                   console.log('breakpoint 1')
                                   
                                       
                                       for(var yy=0;yy<2;yy++){
                                       if(yy===0)
                                       {var listnum = xx*2;
                                         console.log('breakpoint 5');
                                         greatInsert += "<div class='col-xs-6' id='p"+toplist[listnum].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[listnum].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[listnum].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[listnum].placenameru+"</h2><h6>"+toplist[listnum].founddate.day+"."+toplist[listnum].founddate.month+"."+toplist[listnum].founddate.year+"</h6></li></ul></div>";
                                        }
                                       else {
                                         var listnum = xx*2+1;
                                         console.log('breakpoint 7');
                                         greatInsert += "<div class='col-xs-6' id='p"+toplist[listnum].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[listnum].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[listnum].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[listnum].placenameru+"</h2><h6>"+toplist[listnum].founddate.day+"."+toplist[listnum].founddate.month+"."+toplist[listnum].founddate.year+"</h6></li></ul></div>";
                                        eval("$('#row"+rownum+"').append(insert);");
                                        console.log('breakpoint 8');
                                        lastfounddate=toplist[listnum].founddateint;
                                       }
                                       }//for populating row
                                   
                                   if(xx+1 === cycles && left) {
                                     var modrownum = rownum+1;
                                      insert = "<div class='row' style='margin-top:15px;margin-bottom:15px;display:none' id='row"+modrownum+"'></div>";
                                     $('#inserts').append(insert);
                                     console.log('breakpoint 2');
                                      insert = "<div class='col-xs-6' id='p"+toplist[xx].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[xx].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[xx].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[xx].placenameru+"</h2><h6>"+toplist[xx].founddate.day+"."+toplist[xx].founddate.month+"."+toplist[xx].founddate.year+"</h6></li></ul></div>";
                                       eval("$('#row"+rownum+"').append(insert);");
                                     lastfounddate=toplist[xx].founddateint;
                                     $('#morebutton').css('display','none');
                                     console.log('breakpoint 3');
                                   }//if which populates with left ones
                                   
                                   console.log('breakpoint 9');
                                   //eval("$('#row"+rownum+"').fadeIn('slow');")
                                   greatInsert += '</div>';
                                   $(greatInsert).hide().appendTo('#inserts').fadeIn('slow');
                                   var rowName = '#row'+rownum;
                                   rownum++;
                                   console.log('MORE rownum is: '+rownum);
                                 }//for main cycle
                                 //$('#wrap').animate({ scrollTop: $(rowName).offset().top }, 1000);
                                 scrollfn(rowName);
                               }
                    else {
                      var greatInsert ="<div class='row' style='margin-top:15px;margin-bottom:15px;display:none;' id='row"+rownum+"'>";
                      greatInsert += "<div class='col-xs-6' id='p"+toplist[0].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a href='http://recentones.com/places/"+toplist[0].pid+"'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[0].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[0].placenameru+"</h2><h6>"+toplist[0].founddate.day+"."+toplist[0].founddate.month+"."+toplist[0].founddate.year+"</h6></li></ul></div>";
                      greatInsert += '</div>';
                      $(greatInsert).hide().appendTo('#inserts').fadeIn('slow');
                      var rowName = '#row'+rownum;
                      //$('#wrap').animate({ scrollTop: $(rowName).offset().top }, 1000);
                      scrollfn(rowName);
                      rownum++;
                      console.log('MORE rownum is: '+rownum);
                    }
          }
        }
        function ipadpopulate (toplist,funcmore) {
          var cycles = toplist.length;
          console.log('cycles: '+cycles);
          var greatInsert='';
          for(var xx=0;xx<cycles;xx++){
                      console.log('rownum is: '+rownum);
                      greatInsert+="<div class='row' style='margin-top:15px;margin-bottom:15px;' id='row"+rownum+"'><div class='col-xs-12' id='p"+toplist[xx].pid+"'><ul class='list-group'><li style='padding:0px;' class='list-group-item'><a onclick='openpanel("+toplist[xx].pid+")'><img style='width:100%;border-top-left-radius:4px;border-top-right-radius:4px;' src='"+toplist[xx].mainpreview+"' ></a></li><li class='list-group-item'><h2 style='margin-top:0px;'>"+toplist[xx].placenameru+"</h2><h6 style='color:gray;'>"+toplist[xx].founddate.day+"."+toplist[xx].founddate.month+"."+toplist[xx].founddate.year+"</h6></li></ul></div></div>";
                        lastfounddate=toplist[xx].founddateint;
                        rownum++;
                    }//for main cycle
                    $(greatInsert).hide().appendTo('#inserts').fadeIn('slow');
                      var rowName = '#row'+(rownum-3);
                      console.log(rowName);
                      scrollfn(rowName);
                  }
        function openpanel(pid) {
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        if(parsed.trouble === 1)
        {
        console.log('TROUBLE === 1');
        switch (parsed.mtext){
        case('db'):
        alert('Sorry, our database is being updated');
        break;
        case('empty'):
        alert('EMPTY');
        break;
        }}
        else {
        console.log('choice');
        //trouble === 0
        var place = parsed.place;
        if(!parsed.place.pano){
          console.log('empty');
          var placename = place.placenameru;
          var www = place.contacts.www;
          var adressru = place.adressru;
          var adressen = place.adressen;
          var phone = place.contacts.phone;
          var insert = "<div style='margin-top:60px;' class='container'><div class='row'><div class='col-xs-12'><nav><ul class='pager'><li class='previous'><a onclick='back("+pid+")' style='color:#999999;border:0px;' class='back'>Назад</a></li><li style='text-align:center;'><h3 style='color:#999999;display:inline;font-family:roboto-thin;'>"+placename+"</h3></li><li class='next' style='visibility:hidden;'><a>Назад</a></li></ul></nav></div></div><div class='row'><div class='col-xs-12'><ul class='list-group'><li style='padding:100px;text-align:center;background-color:inherit;border: 1px solid #4f4f4f;border-top-left-radius: 8px;border-top-right-radius: 8px;' class='list-group-item'><img src='/bootstrap/images/bl.png' style='width:10vw;margin-bottom:20px;'/><h5>Мы тур еще не отсняли &#40&#45&#58</h5></li><li style='padding-bottom:15px;border:1px solid #4f4f4f;border-bottom:1px solid #4f4f4f;background-color:inherit;border-bottom-right-radius:8px;border-bottom-left-radius:8px;' class='list-group-item'><a class='away' href='"+www+"'>На сайт</a><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+adressru+"</h5><h5 style='color:#747474;font-size:15px;font-weight:bold;margin-bottom:5px;'>"+adressen+"</h5><a href='tel:"+phone+"'><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+phone+"</h5></a></li></ul></div></div></div>";
          $('#panel').append(insert);
          $('.pt-page-2').removeClass('pt-page-moveToRight');
          $('.pt-page-2').css('display','block').addClass('pt-page-moveFromRight pt-page-delay200 pt-page-ontop pt-page-current').css('overflow','auto');
          setTimeout(function(){$('.pt-page-1').removeClass('pt-page-current').css({'overflow':'hidden','visibility':'hidden'});},1000);
          console.log('did output');
        }
        else {
          console.log('haspano');
          var placename = place.placenameru;
          var adressru = place.adressru;
          var adressen = place.adressen;
          var www = place.contacts.www;
          var phone = place.contacts.phone
          var day = place.founddate.day;
          var month = place.founddate.month;
          var year = place.founddate.year;
          var xml = place.xml;
          var insert = "<div style='margin-top:60px;' class='container'><div class='row'><div class='col-xs-12'><nav><ul class='pager'><li class='previous'><a onclick='back("+pid+")' style='color:#999999;border:0px;' class='back'>Назад</a></li><li style='text-align:center;'><h3 style='color:#999999;display:inline;font-family:roboto-thin;'>"+placename+"</h3></li><li class='next' style='visibility:hidden;'><a>Назад</a></li></ul></nav></div></div><div class='row'><div class='col-xs-12'><ul class='list-group' ><li style='padding:0px;text-align:center;background-color:inherit;border: 1px solid #4f4f4f;border-top-left-radius: 8px;border-top-right-radius: 8px;' class='list-group-item'><div id='pano' style='height:400px;'></div></li><li style='padding-bottom:15px;border:1px solid #4f4f4f;border-bottom:1px solid #4f4f4f;background-color:inherit;border-bottom-right-radius:8px;border-bottom-left-radius:8px;' class='list-group-item'><div class='alert alert-warning alert-dismissible' role='alert' style='margin-top:10px;margin-bottom:10px;color:#09bcf5;background-color:inherit;border-color:#09bcf5;'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><strong>Двойной щелчок для перехода в полноэкранный режим</strong></div><a class='away' href='"+www+"'>На сайт</a><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+adressru+"</h5><h5 style='color:#747474;font-size:15px;font-weight:bold;margin-bottom:5px;'>"+adressen+"</h5><a href='tel:"+phone+"'><h5 style='color:#999999;font-size:15px;font-weight:bold;'>"+phone+"</h5></a></li></ul></div></div></div>";
          $('#panel').append(insert);
          var pano = new pano2vrPlayer('pano');
          eval("pano.readConfigUrl('"+xml+"');");
          $('.pt-page-2').removeClass('pt-page-moveToRight');
          $('.pt-page-2').css('display','block').addClass('pt-page-moveFromRight pt-page-delay200 pt-page-ontop pt-page-current').css('overflow','auto');
          setTimeout(function(){$('.pt-page-1').removeClass('pt-page-current').css({'overflow':'hidden','visibility':'hidden'});},1000);
        }
        }
        }
        };
        request.open('POST', '/openpanel', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        request.send('pid='+pid);
        };
        function back(pid) {
           console.log('get back');
           $('.pt-page-1').css('visibility','visible');
           $('.pt-page-2').removeClass('pt-page-moveFromRight pt-page-ontop').addClass('pt-page-moveToRight');
           setTimeout(function(){$('.pt-page-2').removeClass('pt-page-current').empty().css('display','none');$('.pt-page').css('overflow','visible');},500);
           //eval("$('body').scrollTo('#p"+pid+"')");
           //$('.pt-page').css('overflow','visible');
           //$('pt-page').css('overflow','visible');
           //$('.pt-page-2').removeClass('pt-page-moveFromRight pt-page-ontop pt-page-current').addClass('pt-page-moveToRight');
        }
        $('#more').click(function(){
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        if(parsed.trouble === 1)
        {
        console.log('TROUBLE === 1');
        switch (parsed.mtext){
        case('db'):
        alert('Sorry, our database is being updated');
        break;
        case('empty'):
        alert('EMPTY');
        break;
        }}
        else {
        //trouble === 0
        toplist = parsed.mdata.reverse();
        //populate is modified , check if suitable
        populate(toplist,1);
        //$("html, body").animate({ scrollTop: $("#morebutton").scrollTop() }, 1000);
        if(parsed.more === 0){
        $('#morebutton').css('display','none');
        }
        }
        }
        };
        request.open('POST', '/more', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        console.log('lastfounddate='+lastfounddate);
        request.send('lastfounddate='+lastfounddate);
        });
        if(screen.width < 769){
          console.log(toplist);
        ipadpopulate(toplist,0);
        }
        else {
        populate(toplist,0);
        }



           
