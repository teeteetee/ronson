doctype html(lang='en')
head
    meta(charset='utf-8')
    |     
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    |     
    meta(name='viewport', content='width=device-width, initial-scale=1')
    |     
    title R
    // Bootstrap
    link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')
    link(href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css', rel='stylesheet')
    meta(liber de amicitia est)
    meta(property="og:url"           content="http://recentones.com")
    meta(property="og:type"          content="website")
    meta(property="og:title"         content="Recent ones")
    meta(property="og:description"   content="New restaurants in Moscow")
    meta(property="og:image"         content="http://recentones.com/bootstrap/images/rl.png")
    // HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
    script(src='/js/share.js')
    script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')     
    script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')     
    style.
      body {
        width: 100%;
        height: 100%;
        font: 100%/1.4em 'Calibre Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size:14;
      }
      .slideout-menu {
        background-color: #1D1F20;
        background-image: linear-gradient(145deg, #1D1F20, #404348);
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        z-index: 0;
        width: 256px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        display: none;
      }
      .slideout-panel {
        position:relative;
        z-index: 1;
      }
      .slideout-open,
      .slideout-open body,
      .slideout-open .slideout-panel {
        overflow: hidden;
      }
      .slideout-open .slideout-menu {
        display: block;
      }
      .menu a {
        color: #fff;
      }
      .menu a:hover {
        text-decoration: underline;
      }
      .menu-header {
        border-bottom: 1px solid #2a2d2f;
        padding: 20px 0 20px 60px;
        background-size: 32px;
      }
      .menu-header-title {
        font-weight: 600;
        letter-spacing: 0.5px;
        margin: 0;
        font-size:18;
      }
      .menu-section {
        margin: 25px 0;
      }
      .menu-section-title {
        text-transform: uppercase;
        color: #85888d;
        font-weight: 200;
        font-size: 13px;
        letter-spacing: 1px;
        padding: 0 20px;
        margin:0;
      }
      .menu-section-list {
        padding:0;
        margin: 10px 0;
        list-style:none;
      }
      .menu-section-list a {
        text-transform: uppercase;
        color: #85888d;
        font-weight: 200 !important;
        letter-spacing: 2px;
        display: block;
        padding: 20px 20px;
      }
      .menu-section-list a:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color:#fff !important;
        text-decoration: none;
      }
      .menu-section-list .active a {
        background-color: rgba(255, 255, 255, 0.1);
        color:#fff !important;
        text-decoration: none;
      }
        @font-face {
      }
      font-family:high;
      src: url('/bootstrap/fonts/Attentica.ttf');
      }
      @font-face{
      font-family:proxima;
      src:url('/bootstrap/fonts/ProximaNova-Reg-webfont.woff');
      }
      @font-face{
      font-family:boldproxima;
      src:url('/bootstrap/fonts/ProximaNova-Sbold-webfont.woff');
      }
      #inserts h5{
      letter-spacing:2px;
      text-transform:uppercase;
      margin-bottom:0px;
      color:white;
      font-family:roboto-thin;
      font-size:30px;
      margin-top:0px;
      }
      #inserts h2 {
      letter-spacing:2px;
      text-transform:uppercase;
      font-family:high;
      margin-bottom:0px;
      margin-top:0px;
      }
      #inserts h6{
      font-family:roboto-thin; 
      text-transform:uppercase;
      margin-top:0px;
      color:lightgray;
      margin-bottom:0px;
      letter-spacing:2px;
      }
      .col-lg-4 {
      margin-bottom: 20px;
      text-align: center;
      }
      .list-group-item:last-child {
      border-bottom: 2px solid #c2c2c2;
      }
      .away {
        display: inline-block;
        padding: 5px 14px;
        background-color: #4F4F4F; 
        border-radius:15px;
        margin-bottom:10px;
        color:#999999;
      }
      .away:hover {
      text-decoration: none;
      color:#09BCFD;
      }
      .back {
        background-color:#4F4F4F !important;
      }
      .previous:hover{
        border:1 px solid #09bcf5
        color:#09bcf5;
      }
      #wrap a:hover{
        text-decoration:none;
        color:#09BCFD !important;
      }
      #pano canvas {
        border-top-left-radius:8px;
        border-top-right-radius:8px;
        z-index:600;
      }
      :-webkit-full-screen-ancestor:not(iframe) {
       z-index: 5000 !important;
      }
      .list-group {
        cursor:pointer;
      }
      button:focus,button:active {
       outline: none !important;
      }
      .info-abs {
        padding:15px;
        position:absolute;
        bottom:0px;
        width:94%;
        background-color:rgba(0, 0, 0, 0.45);
        color:white;
      }
      a, a:hover {
        text-decoration: none;
      }
      
      .socialbtns, .socialbtns ul, .socialbtns li {
        margin: 0;
        padding: 5px;
      }
      
      .socialbtns li {
          list-style: none outside none;
          display: inline-block;
      }
      
      .socialbtns .fa {
        width: 40px;
          height: 40px;
        color: #ddd;
        background-color: #FFF;
        border: 1px solid #ddd;
        padding-top: 12px;
        border-radius: 22px;
        -moz-border-radius: 22px;
        -webkit-border-radius: 22px;
        -o-border-radius: 22px;
      }
      
      .socialbtns .fa:hover {
        color: #FFF;
        background-color: #000;
        border: 1px solid #000;
      }
      .placerow{
        border-top:1px solid #ddd;
        padding-top:30px;
      }
      .time_tell{
        position:absolute;
        padding: 3px;
        padding-left: 10px;
        padding-right: 11px;
        left: 47%;
        top: 0;
        background-color:white;
        border:1px solid #ddd;
        border-radius:30px;
        color:#ddd;
      }
  body
    .container-fluid#panel.main(style='padding-top:5vh;min-height:100vh;background-color:white;')
      .row(style='text-align:center;')
        h1(style='text-transform:uppercase;font-weight:600;letter-spacing:2px;') Recent ones
        h5(style='text-transform:uppercase;letter-spacing:1px;font-weight:200;') медиа проект: новые участники ресторанного рынка москвы
      .row.socialbtns(style='text-align:center;margin-bottom:50px;')
        ul
          li
            a(href="#" class="social_share fa fa-lg fa-vk" data-type='vk')
          li
            a(href="#" class="social_share fa fa-lg fa-facebook" data-type='fb')
          li
            a(href="#" class="social_share fa fa-lg fa-twitter" data-type='tw')
          li
            a(href="#" class="social_share fa fa-lg fa-google-plus" data-type='gg')
      .row
        #inserts.col-xs-12
      footer(class='footer main' id='morebutton' style='display:none;background-color:white;')
        .container
            nav
              ul(class='pager') 
                li 
                  a(id='more') Еще
      script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js')
      script(src='/js/bootstrap.min.js')
      script.
        $(document).on('click', '.social_share', function(){
            Share.go(this);
        });
        var rownum = 0;
        var lastfounddate;
        var more = #{more};
        if(more===1){
         $('#morebutton').css('display','block');
        }
        var toplist = !{doc};
        //scrolltoplaugin
        $.fn.scrollTo = function( target, options, callback ){
          if(typeof options == 'function' && arguments.length == 2){ callback = options; options = target; }
          var settings = $.extend({
            scrollTarget  : target,
            offsetTop     : 50,
            duration      : 500,
            easing        : 'swing'
          }, options);
          return this.each(function(){
            var scrollPane = $(this);
            var scrollTarget = (typeof settings.scrollTarget == "number") ? settings.scrollTarget : $(settings.scrollTarget);
            var scrollY = (typeof scrollTarget == "number") ? scrollTarget : scrollTarget.offset().top + scrollPane.scrollTop() - parseInt(settings.offsetTop);
            scrollPane.animate({scrollTop : scrollY }, parseInt(settings.duration), settings.easing, function(){
              if (typeof callback == 'function') { callback.call(this); }
            });
          });
        }
        //end of scrollto plugin
        //another scroll fn
        function scrollfn (element){
        $('.wrap').animate({
            scrollTop: $(element).parent().scrollTop() + $(element).offset().top - $(element).parent().offset().top}, {
            duration: 1000,
            specialEasing: {
                width: 'linear',
                height: 'easeOutBounce'
            },
            complete: function (e) {
                console.log("animation completed");
            }
        });}
        //and of the scroll fn
        function populate (toplist,funcmore) {
        for(var xx= 0;xx<toplist.length;xx++)
         {$('#inserts').append("<div class='row placerow' style='margin-top:15px;margin-bottom:15px;' id='row"+xx+"'><div class='time_tell'>12.03.2015</div></div>");
                   var insert = "<div class='col-md-6 col-md-offset-3' id='p"+toplist[xx].pid+"'><a><img style='width:100%;' src='"+toplist[xx].mainpreview+"' ></a><div class='info-abs'><h2>"+toplist[xx].placenameru+"</h2><h6>Открылось: "+toplist[xx].founddate.day+"."+toplist[xx].founddate.month+"."+toplist[xx].founddate.year+"</h6></div></div>";
                     eval("$('#row"+xx+"').append(insert);");
                   lastfounddate=toplist[xx].founddateint;}
        if(funcmore===0){
          $('#morebutton').css('display','none');
        }
        }   
        $('#more').click(function(){
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        if(parsed.trouble === 1)
        {
        console.log('TROUBLE === 1');
        switch (parsed.mtext){
        case('db'):
        alert('Sorry, our database is being updated');
        break;
        case('empty'):
        alert('EMPTY');
        break;
        }}
        else {
        //trouble === 0
        toplist = parsed.mdata.reverse();
        //populate is modified , check if suitable
        populate(toplist,1);
        //$("html, body").animate({ scrollTop: $("#morebutton").scrollTop() }, 1000);
        if(parsed.more === 0){
        $('#morebutton').css('display','none');
        }
        }
        }
        };
        request.open('POST', '/more', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        console.log('lastfounddate='+lastfounddate);
        request.send('lastfounddate='+lastfounddate);
        });
        populate(toplist,more);



           
