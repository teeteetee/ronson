doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    // The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags
    title INTP Love
    // Bootstrap
    link(href='http://fonts.googleapis.com/css?family=Josefin+Sans&subset=latin,latin-ext', rel='stylesheet', type='text/css')
    link(href='/bootstrap/css/bootstrap.min.css', rel='stylesheet')
    // HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    // WARNING: Respond.js doesn't work if you view the page via file://
    //if lt IE 9
      script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')
      script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')
    style.
      body{
      background-color:#333;
      }
      .header {
      text-align:center;
      }
      .header h1 {
      margin-top:50px;
      text-transform: uppercase;
      }
      .header h4 {
      margin-top:20px;
      margin-bottom:30px;
      text-transform: uppercase;
      font-weight: 200;
      color: #bbb;
      }
      .footer {
      text-align:center;
      bottom: 0;
      width: 100%;
      }
      .participate {
      text-align:center;
      margin-top:50px;
      margin-bottom:70px;
      }
      .language {
      position:absolute;
      top:20px;
      right:20px;
      }
      #apply {
      display:none;
      }
      #ru_cont {
      display:none;
      }
      .user {
      border-bottom:1px solid #eee;
      padding-top:20px;
      padding-bottom:15px;
      padding-left:10px;
      }
      .user h5 {
      margin-top:0px;
      }
      .user:last-child {
      border-bottom:none;
      }
      .emptyavatar {
      /*margin:30px;
      margin-left:50px;
      margin-right:50px;*/
      margin:auto;
      width:90px;
      height:90px;
      background-color:#eee;
      border-radius:50%;
      }
      @media (max-width: 767px) {
      #main{
      }
      }
      h6 {
      color:#ddd;
      }
      #head .btn-default,#head .btn-default:hover,#head .btn-default:focus {
      border-color:teal;
      background-color:#333;
      color:teal;
      }
      #head .btn-default.active,#head .btn-default.active:active {
      border-color:teal;
      background-color:teal;
      color:#333;
      }
      #head {
      border: 1px solid #232323;
      padding-bottom:30px;
      text-align:center;
      border-top-left-radius:6px;
      border-top-right-radius:6px;
      background-color:#222;
      }
      .pagination>.active>a, .pagination>.active>a:focus, .pagination>.active>a:hover, .pagination>.active>span, .pagination>.active>span:focus, .pagination>.active>span:hover {
      background-color:teal;
      border-color:teal;
      color:#333;
      }
      .pagination>li>a, .pagination>li>span {
      background-color:#333;
      border-color:teal;
      color:teal;
      }
      .btn-send {
      margin-top:20px;
      margin-bottom:5px;
      }
      .user .col-xs-9 {
      padding-left:10px;
      }
      .modal input {
      max-width:400px;
      }
      .user .col-xs-3 {
      text-align:center;
      }
      .glyphicon-map-marker {
        margin-right:5px
      }
      .loader {
      margin: 60px auto;
      margin-top:20%;
      font-size: 10px;
      position: relative;
      text-indent: -9999em;
      border-top: 1.1em solid rgba(255, 255, 255, 0.2);
      border-right: 1.1em solid rgba(255, 255, 255, 0.2);
      border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
      border-left: 1.1em solid #ffffff;
      -webkit-transform: translateZ(0);
      -ms-transform: translateZ(0);
      transform: translateZ(0);
      -webkit-animation: load8 1.1s infinite linear;
      animation: load8 1.1s infinite linear;
      }
      .loader,
      .loader:after {
        border-radius: 50%;
        width: 10em;
        height: 10em;
      }
      @-webkit-keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      @keyframes load8 {
        0% {
          -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }
      .regerr {
        text-align:center;
        display:none;
      }
  body
    //
      <div class='language'>
      <a id='eng' class='active'>ENG</a>
      <span style='color:#ddd;'>|</span>
      <a id='ru'>RU</a>
      </div>
    #register.modal.fade(tabindex='-1', role='dialog', aria-labelledby='myModalLabel')
      .modal-dialog(role='document')
        .modal-content
          .modal-header
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true')  ×
            h4.modal-title(style='color:#ddd;')  Регистрация 
          .modal-body
          .row.regerr
            .col-xs-12
              h3#regerrtext
          .row
            .col-xs-12
              form
                .form-group
                  label(for='email')  email
                  input#email.form-control(type='email', autocomplete='off', placeholder='Neuroscience')
                .form-group
                  label(for='pagetitle')  Имя
                  input#uname.form-control(type='text', autocomplete='off', placeholder='Neuroscience')
                .form-group
                  label(for='pagetitle')  Пароль
                  input#pas.form-control(type='password', autocomplete='off', placeholder='Neuroscience')
                .form-group
                  label(for='pagetitle')  Город
                  input#city.form-control(type='text', autocomplete='off', placeholder='Neuroscience')
                .form-group
                  label(for='pagetitle')  Возраст
                  input#age.form-control(type='text', autocomplete='off', placeholder='Neuroscience')
                .btn-group 
                  button(class='btn btn-default active' id='female') Female
                  button(class='btn btn-default' id='male') Male
          .modal-footer
            button.btn.btn-primary#regbutton  Регистрация
    #login.modal.fade(tabindex='-1', role='dialog', aria-labelledby='myModalLabel')
      .modal-dialog(role='document')
        .modal-content
          .modal-header
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true')  ×
            h4.modal-title(style='color:#ddd;')  Регистрация 
          .modal-body
            form
              .form-group
                label(for='email')  email
                input#email.form-control(type='email', autocomplete='off', placeholder='Neuroscience')
              .form-group
                label(for='pagetitle')  Пароль
                input#pas.form-control(type='password', autocomplete='off', placeholder='Neuroscience')
          .modal-footer
            button.btn.btn-primary#loginbutton  Войти
    .container(id='wait' style='background-color:rgba(0, 0, 0, 0.63);position:fixed;width:100%;height:100%;z-index:9999;display:none;')
        .row(id='spin') 
          .col-xs-12(style='text-align:center;')
            .loader
    #eng_cont.container(style='padding-top:60px;')
      //
        <div class='language'>
        <a class='active eng'>ENG</a>
        <span style='color:#ddd;'>|</span>
        <a class='ru'>RU</a>
        </div>
      //
        <div class='page-header header'>
        <h1><span><img src='images/cfrp.png' width='40'></span></h1>
        <h1>Consciousness:<br> essential components & infrastructure</h1>
        <h4 > Research project</h4>
        </div>
      .row
        .col-xs-12
          h1(style='font-family:Josefin Sans;text-align:center;margin-bottom:40px;letter-spacing: 12px;color: #B1EDFF;text-shadow: 1px 1px 10px #6DB7dc') INTPLOVE

      .row#regrow(style='padding-top:30px;padding-bottom:30px;text-align:center;')
        .col-xs-12
          .btn-group
            button#showregbutton(class='btn btn-danger') Регистрация
            button#showloginbutton(class='btn btn-danger') Вход
      .row(style='border-radius:6px;')
        #main.col-xs-12.col-sm-8.col-sm-offset-2.col-md-6.col-md-offset-3.col-lg-6.col-lg-offset-3(style='background-color:white;border-radius:6px;')
          #head.row
            .col-xs-12
              h4(style='text-align:center;margin-bottom:20px;margin-top:30px') Я ищу
              .btn-group.btn-group-sm
                button.btn.btn-primary Парня
                button.btn.btn-primary Девушку
                button.btn.btn-primary.active Всех
              h5(style='color:gray;margin-top:20px;')
                | от 
                input(type='text' style='max-width:30px;')           
                | до
                input(type='text' style='max-width:30px;')
                |             лет
              input#location(type='text' style='max-width:500px;margin:auto;' class='form-control')
            //
              <nav>
              <ul class="pagination" style='margin-bottom:0px;'>
              <li>
              <a href="#" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
              </a>
              </li>
              <li class='active'><a href="#">1</a></li>
              <li><a href="#">2</a></li>
              <li><a href="#">3</a></li>
              <li><a href="#">4</a></li>
              <li><a href="#">5</a></li>
              <li>
              <a href="#" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
              </a>
              </li>
              </ul>
              </nav>
          .row.user
            .col-xs-3
              .emptyavatar
              a.btn.btn-sm.btn-send.btn-default Написать
            .col-xs-9
              h5 Dima, 24
              h6
                span.glyphicon.glyphicon-map-marker(style='margin-right:5px;')
                | Москва
              p
                | Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec a diam lectus. Sed sit amet ipsum mauris. Maecenas congue ligula ac quam viverra nec consectetur ante hendrerit. Donec et mollis dolor. Praesent et diam eget libero egestas mattis sit amet vitae augue. Nam tincidunt congue enim, ut porta lorem lacinia consectetur.
    #ru_cont.container(style='display:none;')
    footer.footer
      .container
        .row
          .col-xs-12
            h6(style='color:#c35;font-weight:200;margin-top:40px;') INTP Love 2015
            a(style='margin-bottom:30px;font-weight:200;color:#c35;', href='mailto:feedback@intplove.ru') Contact us
    // jQuery (necessary for Bootstrap's JavaScript plugins)
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js')
    // Include all compiled plugins (below), or include individual files as needed
    //script(src='/js/jquery.min.js')
    script(src='/js/bootstrap.min.js')
    script(src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8lRm1SQ5qlhTnvAAwX5Y8mO-P9qq8HfQ&signed_in=true&libraries=places&callback=initialize" async defer)
    script.
      $('#male').click(function(){
        if($('#male').hasClass('active')){
        }
        else{
          $('#male').addClass('active');
          $('#female').removeClass('active');
        }
        });
      $('#female').click(function(){
        if($('#female').hasClass('active')){
        }
        else{
          $('#female').addClass('active');
          $('#male').removeClass('active');
        }
        });
      $('#showloginbutton').click(function(){
      $('#login').modal('show');
      });
      $('#showregbutton').click(function(){
      $('#register').modal('show');
      });
      var userlist = !{JSON.stringify(done)};
      if(userlist) {
        userlist.forEach( function (element,index){
          var insert="<div class='row user'><div class='col-xs-3'><div class='emptyavatar'></div><a class='btn btn-sm btn-send btn-default>Написать</a></div><div class='col-xs-9'><h5>"+element.name+"</h5><h6><span class='glyphicon glyphicon-map-marker'></span>"+element.city+"</h6></div></div>";
          $('#main').append(insert);
          });
      }
      var user = !{JSON.stringify(user)};
      if(user.length){
        $('#regrow').css('display','none');
      }
      $('.btn-send').click(function(){
      $('#register').modal('show');
      });
      $('#applybutton_eng').click(function(){
      $('#apply_eng').modal('show');
      });
      $('#applybutton_ru').click(function(){
      $('#apply_ru').modal('show');
      });
      $('#ru').click(function(){
      console.log('hey');
      if(!$('#ru').hasClass('active')){
      console.log('double hey');
      $('#eng_cont').css('display','none');
      $('#ru_cont').css('display','block');
      $('#eng').removeClass('active');
      $('#ru').addClass('active');
      }
      });
      $('#eng').click(function(){
      console.log('hey');
      if(!$('#eng').hasClass('active')){
      console.log('double hey');
      $('#ru_cont').css('display','none');
      $('#eng_cont').css('display','block');
      $('#ru').removeClass('active');
      $('#eng').addClass('active');
      }
      });
      function runreg() {
         if ($('#uname').val() && $('#pas').val() && validateEmail($('#email').val()) && $('#email').val() && $('#city').val() && $('#age').val())
        {
          if($('.regerr').css('display') === 'block') {
            $('.regerr').slideToggle();
          }
        var male=0;
        if($('#male').hasClass('active')) {
          male=1;
        }
        $('#wait').css('display','block');
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        // do your job here
        if (parsed.trouble === 1)
        {
        $('.message').empty();
        switch (parsed.mtext)
        {
        case('fail'):
        //$('.message').append("<h5 style='color:#fc454e;'>Sorry, omething is slightly off with the DB, try again in a couple of minutes or contact support</h5>");
        $('#error_text').text('Network Error');
        $('#error_Modal').modal('show');
        break;
        case('email exists'):
        //$('.message').append("<h5 style='color:#fc454e;'>Provided email is already used by one of the users</h5>");
        $('#error_text').text('email_inuse');
        $('#error_Modal').modal('show');
        break;
        
        }
        }
        else { window.location = 'http://intplove.com';}
        }
        };
        request.open('POST', '/new', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        // Most libraries like jQuery/Prototype/Dojo do this
        request.send("mail="+$('#email').val()+"&p="+$('#pas').val()+"&gn="+male+"&age"+$('#age').val()+"&city="+$('#city').val()+"&uname="+$('#uname').val());
        }
        else {
          $('#regerrtext').text('Заполните все поля');
          $('.regerr').slifdeToggle();
          }
        }
        //sonorous-shore-113306
        function initialize() {
         var options = {
          types: ['(cities)'],
          componentRestrictions: {}
         };
         var input = document.getElementById('location');
         var autocomplete = new google.maps.places.Autocomplete(input, options);
         google.maps.event.addListener(autocomplete, 'place_changed', function(){
           //# $('.your-input').val() to get the value from your input
           var place = autocomplete.getPlace();
           console.log(place.place_id);
           
         });
        }
         function validateEmail(email) { 
        console.log('checking email');
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);} 
        //--------------------
        // AUTHSUBMIT FUNCTION
        //--------------------
        var allowauth = 1;
        function authsubmit() {
        allowauth = 0;
        var vlgn = $('#mail').val();
        var vphr = $('#p').val();
        console.log(vlgn +" , "+vphr);
        request = new XMLHttpRequest();
        request.onreadystatechange = function () {
        var DONE = this.DONE || 4;
        if (this.readyState === DONE){
        var index;
        parsed = JSON.parse(request.responseText);
        console.log(parsed);
        if(parsed.trouble === 1)
        {
        console.log('TROUBLE === 1');
        switch (parsed.mtext){
        case('db'):
        $('#pwderr').empty();
        $('#pwderr').append("<p>Sorry, omething is slightly off with the DB, try again in a couple of minutes or contact support</p>");
        $('#pwderr').slideToggle();
        allowauth = 1;
        break;
        case('wrong pas'):
        $('#pwderr').empty();
        $('#pwderr').append("<p>Wrong password</p>");
        $('#pwderr').slideToggle();
        allowauth = 1;
        break;
        case('wronguser'):
        $('#pwderr').empty();
        $('#pwderr').append("<p>Wrong email</p>");
        $('#pwderr').slideToggle();
        allowauth =1;
        break;
        }}
        else {
        window.location = 'http://peopleandbooks.com';
        }
        }
        };
        request.open('POST', '/check', true);
        request.setRequestHeader('X-Requested-With', 'XMLHttpRequest');  // Tells server that this call is made for ajax purposes.
        request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //Most libraries like jQuery/Prototype/Dojo do this
        request.send("phr="+vphr+"&lgn="+vlgn);
        }
        //END OF AUTHSUBMIT FUNCTION
         

          

